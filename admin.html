<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin QR</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 8px; }
    img { max-width: 120px; }
  </style>
</head>
<body>

<h1>Panel Admin</h1>

<h3>Subir imagen</h3>
<input type="text" id="titulo" placeholder="T√≠tulo">
<br><br>
<input type="file" id="imagen">
<br><br>
<button id="btnSubir">Subir</button>

<h3>Im√°genes</h3>
<table>
  <thead>
    <tr>
      <th>T√≠tulo</th>
      <th>Imagen</th>
    </tr>
  </thead>
  <tbody id="lista"></tbody>
</table>

<script>
  // üîπ CONFIGURACI√ìN
  const SUPABASE_URL = "https://gucdzmoacbbivgrrdyhr.supabase.co";
  const SUPABASE_KEY = "sb_publishable_kh6FV9fQtuxq46CHeVHRLQ_0MHE0D2U";

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // üîπ SUBIR
  document.getElementById("btnSubir").addEventListener("click", subir);

  async function subir() {
    const titulo = document.getElementById("titulo").value;
    const file = document.getElementById("imagen").files[0];

    if (!file || !titulo) {
      alert("Falta t√≠tulo o imagen");
      return;
    }

    const nombre = Date.now() + "_" + file.name;

    const { error } = await sb.storage
      .from("qrs")
      .upload(nombre, file);

    if (error) {
      alert(error.message);
      return;
    }

    const { data } = sb.storage.from("qrs").getPublicUrl(nombre);

    await sb.from("imagenes").insert({
      titulo: titulo,
      url: data.publicUrl
    });

    document.getElementById("titulo").value = "";
    document.getElementById("imagen").value = "";

    cargar();
  }

  // üîπ LISTAR
  async function cargar() {
    const { data } = await sb.from("imagenes").select("*").order("id", { ascending: false });

    const tbody = document.getElementById("lista");
    tbody.innerHTML = "";

    data.forEach(img => {
      tbody.innerHTML += `
        <tr>
          <td>${img.titulo}</td>
          <td><img src="${img.url}"></td>
        </tr>
      `;
    });
  }

  cargar();
</script>

</body>
</html>
